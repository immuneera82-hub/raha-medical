cat > backend/templates/dashboard.html << 'ENDOFFILE'
<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ملفي الشخصي | Raha Medical</title>
    <link rel="icon" type="image/png" href="/static/images/favicon.png">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <style>
        body { font-family: 'Cairo', sans-serif; }
        [x-cloak] { display: none !important; }
        .tab-active { background-color: #f0fdfa; color: #0f766e; border-right: 3px solid #0f766e; }
    </style>
</head>
<body class="bg-gray-100" x-data="dashboardApp()">

    <div x-show="loading" class="fixed inset-0 bg-white z-50 flex flex-col items-center justify-center">
        <div class="animate-spin rounded-full h-16 w-16 border-t-4 border-b-4 border-teal-600 mb-4"></div>
        <p class="text-gray-600">جاري التحميل...</p>
    </div>

    <div x-show="!loading" x-cloak class="min-h-screen flex flex-col md:flex-row">
        
        <aside class="w-full md:w-72 bg-white shadow-lg md:flex flex-col hidden">
            <div class="p-6 border-b">
                <a href="/"><img src="/static/images/logo.png" class="h-10" alt="Logo"></a>
            </div>
            
            <nav class="flex-1 p-4 space-y-2">
                <button @click="currentTab = 'profile'" :class="currentTab === 'profile' ? 'tab-active' : 'text-gray-600 hover:bg-gray-50'" class="w-full flex items-center gap-3 px-4 py-3 rounded-lg font-medium">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/></svg>
                    تعديل الحساب
                </button>
                
                <button @click="currentTab = 'reports'" :class="currentTab === 'reports' ? 'tab-active' : 'text-gray-600 hover:bg-gray-50'" class="w-full flex items-center gap-3 px-4 py-3 rounded-lg font-medium">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/></svg>
                    التقارير الطبية
                </button>
                
                <button @click="currentTab = 'hospital'" :class="currentTab === 'hospital' ? 'tab-active' : 'text-gray-600 hover:bg-gray-50'" class="w-full flex items-center gap-3 px-4 py-3 rounded-lg font-medium">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"/></svg>
                    المستشفيات
                </button>
            </nav>
            
            <div class="p-4 border-t">
                <a href="/" class="flex items-center gap-2 text-gray-500 hover:text-teal-600 py-2">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"/></svg>
                    الرئيسية
                </a>
                <button @click="logout()" class="flex items-center gap-2 text-red-500 hover:text-red-700 py-2 w-full">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"/></svg>
                    خروج
                </button>
            </div>
        </aside>

        <div class="md:hidden bg-white shadow-sm p-4 flex justify-between items-center">
            <a href="/"><img src="/static/images/logo.png" class="h-8" alt="Logo"></a>
            <div class="flex gap-2">
                <button @click="currentTab = 'profile'" :class="currentTab === 'profile' ? 'bg-teal-100 text-teal-700' : 'bg-gray-100'" class="p-2 rounded-lg">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/></svg>
                </button>
                <button @click="currentTab = 'reports'" :class="currentTab === 'reports' ? 'bg-teal-100 text-teal-700' : 'bg-gray-100'" class="p-2 rounded-lg">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/></svg>
                </button>
                <button @click="currentTab = 'hospital'" :class="currentTab === 'hospital' ? 'bg-teal-100 text-teal-700' : 'bg-gray-100'" class="p-2 rounded-lg">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"/></svg>
                </button>
            </div>
        </div>

        <main class="flex-1 p-4 md:p-10 overflow-y-auto">
            
            <div x-show="currentTab === 'profile'">
                <h1 class="text-2xl font-bold mb-6">تعديل الحساب</h1>
                
                <div class="bg-white rounded-2xl shadow-sm p-6 mb-6">
                    <div class="flex items-center gap-4 mb-6">
                        <img :src="profile.avatar_url || 'https://ui-avatars.com/api/?name=User'" class="w-16 h-16 rounded-full border-4 border-teal-50">
                        <div>
                            <h2 class="text-xl font-bold" x-text="profile.full_name"></h2>
                            <p class="text-gray-500 text-sm">رقم الملف: <span class="font-mono text-teal-600" x-text="profile.patient_id"></span></p>
                        </div>
                    </div>
                    
                    <div class="grid md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">الاسم الكامل</label>
                            <input type="text" x-model="profile.full_name" class="w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-teal-500 outline-none">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">البريد الإلكتروني</label>
                            <input type="email" :value="profile.email" readonly class="w-full px-4 py-3 bg-gray-50 border rounded-lg text-gray-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">رقم الهاتف</label>
                            <input type="tel" x-model="profile.phone" placeholder="+964" class="w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-teal-500 outline-none">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">الدولة</label>
                            <select x-model="profile.country" class="w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-teal-500 outline-none">
                                <option value="">اختر الدولة</option>
                                <option value="العراق">العراق</option>
                                <option value="السعودية">السعودية</option>
                                <option value="الإمارات">الإمارات</option>
                                <option value="الكويت">الكويت</option>
                                <option value="قطر">قطر</option>
                                <option value="البحرين">البحرين</option>
                                <option value="عمان">عمان</option>
                                <option value="الأردن">الأردن</option>
                                <option value="لبنان">لبنان</option>
                                <option value="مصر">مصر</option>
                                <option value="اليمن">اليمن</option>
                            </select>
                        </div>
                        <div class="md:col-span-2">
                            <label class="block text-sm font-medium text-gray-700 mb-2">العنوان</label>
                            <input type="text" x-model="profile.address" placeholder="المدينة، المنطقة" class="w-full px-4 py-3 border rounded-lg focus:ring-2 focus:ring-teal-500 outline-none">
                        </div>
                    </div>
                    
                    <div class="mt-6 flex justify-end">
                        <button @click="saveProfile()" class="bg-teal-600 text-white px-6 py-3 rounded-lg font-bold hover:bg-teal-700">حفظ التغييرات</button>
                    </div>
                </div>
            </div>

            <div x-show="currentTab === 'reports'">
                <h1 class="text-2xl font-bold mb-6">التقارير الطبية</h1>
                
                <div class="bg-white rounded-2xl shadow-sm p-6 mb-6">
                    <div class="border-2 border-dashed border-teal-200 rounded-xl p-8 text-center bg-teal-50 hover:bg-teal-100 cursor-pointer" @click="$refs.reportInput.click()">
                        <input type="file" x-ref="reportInput" @change="uploadReport($event)" accept="image/*,.pdf" class="hidden" multiple>
                        <div class="w-16 h-16 bg-white rounded-full flex items-center justify-center mx-auto mb-4 shadow">
                            <svg class="w-8 h-8 text-teal-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/></svg>
                        </div>
                        <h3 class="text-lg font-bold text-teal-800">رفع تقرير جديد</h3>
                        <p class="text-gray-600 mt-2">PDF أو صورة</p>
                    </div>
                </div>
                
                <div class="bg-white rounded-2xl shadow-sm overflow-hidden">
                    <div class="p-4 border-b bg-gray-50">
                        <h3 class="font-bold">تقاريري المرفوعة</h3>
                    </div>
                    <template x-if="documents.length === 0">
                        <div class="p-8 text-center text-gray-500">لا توجد تقارير مرفوعة بعد</div>
                    </template>
                    <template x-for="doc in documents" :key="doc.id">
                        <div class="flex items-center justify-between p-4 border-b hover:bg-gray-50">
                            <div class="flex items-center gap-3">
                                <div class="w-10 h-10 bg-teal-100 rounded-lg flex items-center justify-center">
                                    <svg class="w-5 h-5 text-teal-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/></svg>
                                </div>
                                <div>
                                    <p class="font-medium" x-text="doc.file_name"></p>
                                    <p class="text-xs text-gray-400" x-text="new Date(doc.created_at).toLocaleDateString('ar')"></p>
                                </div>
                            </div>
                            <a :href="'/api/download?url=' + encodeURIComponent(doc.file_url) + '&filename=' + doc.file_name" class="text-teal-600 hover:bg-teal-50 px-3 py-1 rounded-lg">تحميل</a>
                        </div>
                    </template>
                </div>
            </div>

            <div x-show="currentTab === 'hospital'">
                <h1 class="text-2xl font-bold mb-6">مستندات المستشفى</h1>
                <div class="bg-white rounded-2xl shadow-sm p-8 text-center">
                    <svg class="w-16 h-16 text-gray-300 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"/></svg>
                    <h3 class="text-lg font-bold text-gray-700 mb-2">قريباً</h3>
                    <p class="text-gray-500">سيتم إضافة مستندات المستشفى هنا</p>
                </div>
            </div>
        </main>
    </div>

    <script>
        const supabaseUrl = 'https://rusuwljflrremkszgstn.supabase.co'
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJ1c3V3bGpmbHJyZW1rc3pnc3RuIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQ0Njk3NjgsImV4cCI6MjA3MDA0NTc2OH0.DFioJz2FNQwpzFEilgagcAFtvQftCkVn4ts-yTjT5vU'
        const sbClient = supabase.createClient(supabaseUrl, supabaseKey)

        function dashboardApp() {
            return {
                loading: true,
                currentTab: 'profile',
                user: null,
                profile: {},
                documents: [],
                
                async init() {
                    const { data: { session } } = await sbClient.auth.getSession();
                    if (!session) {
                        window.location.href = '/';
                        return;
                    }
                    this.user = session.user;
                    await this.loadProfile();
                    await this.loadDocuments();
                    this.loading = false;
                },
                
                async loadProfile() {
                    const { data } = await sbClient.from('profiles').select('*').eq('id', this.user.id).single();
                    if (data) this.profile = data;
                },
                
                async loadDocuments() {
                    const { data } = await sbClient.from('documents').select('*').eq('user_id', this.user.id).order('created_at', { ascending: false });
                    if (data) this.documents = data;
                },
                
                async saveProfile() {
                    const { error } = await sbClient.from('profiles').update({
                        full_name: this.profile.full_name,
                        phone: this.profile.phone,
                        country: this.profile.country,
                        address: this.profile.address,
                        updated_at: new Date().toISOString()
                    }).eq('id', this.user.id);
                    
                    if (error) alert('حدث خطأ: ' + error.message);
                    else alert('تم حفظ التغييرات بنجاح');
                },
                
                async uploadReport(event) {
                    const files = event.target.files;
                    if (!files.length) return;
                    
                    for (const file of files) {
                        const fileName = `${this.user.id}/${Date.now()}_${file.name}`;
                        
                        const { data: uploadData, error: uploadError } = await sbClient.storage
                            .from('documents')
                            .upload(fileName, file);
                        
                        if (uploadError) {
                            alert('خطأ في رفع الملف: ' + uploadError.message);
                            continue;
                        }
                        
                        const { data: { publicUrl } } = sbClient.storage.from('documents').getPublicUrl(fileName);
                        
                        await sbClient.from('documents').insert({
                            user_id: this.user.id,
                            patient_code: this.profile.patient_id,
                            file_name: file.name,
                            file_url: publicUrl,
                            file_size: file.size,
                            doc_category: 'patient_report'
                        });
                    }
                    
                    await this.loadDocuments();
                    alert('تم رفع الملفات بنجاح');
                },
                
                async logout() {
                    await sbClient.auth.signOut();
                    window.location.href = '/';
                }
            }
        }
    </script>
</body>
</html>
ENDOFFILE