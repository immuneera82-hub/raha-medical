{% extends "knowledge_base/base.html" %}

{% block content %}
<!-- SEO Metadata override (if passed from backend) -->
{% if global_specialty %}
{% set page_title = global_specialty.seo_title_ar or local_specialty.name_ar ~ ' ÙÙŠ ' ~ hospital.name_ar %}
{% set page_description = global_specialty.meta_description_ar or local_specialty.description %}
{% else %}
{% set page_title = local_specialty.name_ar ~ ' ÙÙŠ ' ~ hospital.name_ar %}
{% set page_description = local_specialty.description %}
{% endif %}

<div class="bg-gray-50 min-h-screen pb-20">

    <!-- Breadcrumb -->
    <div class="bg-white border-b border-gray-200 py-3">
        <div class="container mx-auto px-4">
            <nav class="flex text-sm text-gray-500 gap-2 mb-0" aria-label="Breadcrumb">
                <a href="/" class="hover:text-teal-600">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
                <span class="text-gray-400">/</span>
                <a href="/hospitals" class="hover:text-teal-600">Ø§Ù„Ù…Ø³ØªØ´ÙÙŠØ§Øª</a>
                <span class="text-gray-400">/</span>
                <a href="/hospitals/{{ hospital.slug }}" class="hover:text-teal-600">{{ hospital.name_ar }}</a>
                <span class="text-gray-400">/</span>
                <a href="/hospitals/{{ hospital.slug }}/specialties" class="hover:text-teal-600">Ø§Ù„ØªØ®ØµØµØ§Øª</a>
                <span class="text-gray-400">/</span>
                <span class="text-gray-900 font-bold">{{ local_specialty.name_ar if local_specialty else
                    global_specialty.name_ar }}</span>
            </nav>
        </div>
    </div>

    <!-- Hero Section -->
    <div class="relative bg-teal-900 text-white overflow-hidden py-12 md:py-20">
        <div class="absolute inset-0 opacity-20">
            <!-- Placeholder for generated realistic image -->
            {% if local_specialty.image_url %}
            <img src="{{ local_specialty.image_url }}" class="w-full h-full object-cover">
            {% elif global_specialty.image_url %}
            <img src="{{ global_specialty.image_url }}" class="w-full h-full object-cover">
            {% else %}
            <!-- Fallback abstract/medical pattern or Nano Banana generated asset -->
            <div class="w-full h-full bg-[url('/static/images/medical_pattern.svg')]"></div>
            {% endif %}
        </div>
        <div class="absolute inset-0 bg-gradient-to-r from-teal-900 via-teal-900/80 to-transparent"></div>

        <div class="container mx-auto px-4 relative z-10">
            <h1 class="text-3xl md:text-5xl font-bold mb-4">
                {{ local_specialty.name_ar if local_specialty else global_specialty.name_ar }}
            </h1>
            <h2 class="text-xl md:text-2xl text-teal-200 mb-6 font-light">
                ÙÙŠ {{ hospital.name_ar }} - {{ hospital.city }}
            </h2>
            <div class="flex gap-4">
                <a href="#contact"
                    class="bg-yellow-400 text-yellow-900 px-8 py-3 rounded-full font-bold hover:bg-yellow-300 transition shadow-lg">
                    Ø­Ø¬Ø² Ù…ÙˆØ¹Ø¯
                </a>
                <button onclick="openWhatsApp()"
                    class="border-2 border-white text-white px-8 py-3 rounded-full font-bold hover:bg-white hover:text-teal-900 transition flex items-center gap-2">
                    <span>ğŸ’¬</span> Ø§Ø³ØªØ´Ø§Ø±Ø© ÙˆØ§ØªØ³Ø§Ø¨
                </button>
            </div>
        </div>
    </div>

    <div class="container mx-auto px-4 py-12 grid grid-cols-1 lg:grid-cols-3 gap-12">

        <!-- Main Content -->
        <main class="lg:col-span-2 space-y-12">

            <!-- Executive Summary (AI Generated Content) -->
            <section class="bg-white rounded-2xl p-8 shadow-sm">
                <h3 class="text-2xl font-bold text-gray-900 mb-4 border-r-4 border-teal-500 pr-4">Ù†Ø¸Ø±Ø© Ø¹Ø§Ù…Ø©</h3>
                <div class="prose prose-lg text-gray-700 leading-relaxed">
                    {% if local_specialty.description %}
                    <p>{{ local_specialty.description }}</p>
                    {% elif global_specialty.description_ar %}
                    <p>{{ global_specialty.description_ar }}</p>
                    {% else %}
                    <p>
                        ÙŠÙ‚Ø¯Ù… Ù‚Ø³Ù… {{ local_specialty.name_ar if local_specialty else global_specialty.name_ar }} ÙÙŠ {{
                        hospital.name_ar }}
                        Ø£Ø­Ø¯Ø« Ø§Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ø·Ø¨ÙŠØ© Ø§Ù„Ù…ØªÙƒØ§Ù…Ù„Ø©. Ù†ØªÙ…ÙŠØ² Ø¨ÙˆØ¬ÙˆØ¯ Ù†Ø®Ø¨Ø© Ù…Ù† Ø§Ù„Ø£Ø·Ø¨Ø§Ø¡ ÙˆØ§Ø³ØªØ®Ø¯Ø§Ù… Ø£Ø­Ø¯Ø« Ø§Ù„ØªÙ‚Ù†ÙŠØ§Øª
                        Ù„Ø¶Ù…Ø§Ù† Ø£ÙØ¶Ù„ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø¹Ù„Ø§Ø¬ÙŠØ© Ù„Ù„Ù…Ø±Ø¶Ù‰ØŒ Ù…Ø¹ Ù…Ø±Ø§Ø¹Ø§Ø© Ø£Ø¹Ù„Ù‰ Ù…Ø¹Ø§ÙŠÙŠØ± Ø§Ù„Ø¬ÙˆØ¯Ø© ÙˆØ§Ù„Ø³Ù„Ø§Ù…Ø© Ø§Ù„Ø¯ÙˆÙ„ÙŠØ©.
                    </p>
                    {% endif %}
                </div>
            </section>

            <!-- Treatments / Sub-specialties -->
            {% if local_specialty.treatments %}
            <section>
                <h3 class="text-2xl font-bold text-gray-900 mb-6">Ø§Ù„Ø­Ø§Ù„Ø§Øª Ø§Ù„ØªÙŠ Ù†Ø¹Ø§Ù„Ø¬Ù‡Ø§</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    {% for treatment in local_specialty.treatments %}
                    <div class="flex items-center gap-3 bg-white p-4 rounded-xl shadow-sm border border-gray-100">
                        <span
                            class="w-8 h-8 flex items-center justify-center bg-teal-100 text-teal-600 rounded-full">âœ“</span>
                        <span class="font-semibold text-gray-800">{{ treatment }}</span>
                    </div>
                    {% endfor %}
                </div>
            </section>
            {% endif %}

            <!-- Technology -->
            <!-- We could filter hospital technologies related to this specialty if we had mapping -->

            <!-- Contact Section -->
            <section id="contact"
                class="bg-teal-900 rounded-3xl p-8 text-center text-white shadow-2xl overflow-hidden relative">
                <div class="relative z-10">
                    <h2 class="text-3xl font-bold mb-4">Ù‡Ù„ ØªØ¨Ø­Ø« Ø¹Ù† Ø¹Ù„Ø§Ø¬ Ù„Ù€ {{ local_specialty.name_ar if local_specialty
                        else global_specialty.name_ar }}ØŸ</h2>
                    <p class="text-teal-100 mb-8 max-w-2xl mx-auto">ØªÙˆØ§ØµÙ„ Ù…Ø¹Ù†Ø§ Ø§Ù„Ø¢Ù† Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ø³ØªØ´Ø§Ø±Ø© Ø·Ø¨ÙŠØ© Ù…Ø¬Ø§Ù†ÙŠØ©
                        ÙˆØªÙ‚Ø¯ÙŠØ± Ù„Ù„ØªÙƒÙ„ÙØ© Ù…Ù† {{ hospital.name_ar }}</p>

                    <div class="flex flex-col md:flex-row justify-center gap-4">
                        <button onclick="openWhatsApp()"
                            class="bg-green-500 hover:bg-green-600 text-white px-8 py-4 rounded-xl font-bold text-lg shadow-lg flex items-center justify-center gap-3 transition">
                            <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24">
                                <path
                                    d="M.057 24l1.687-6.163c-1.041-1.804-1.588-3.849-1.587-5.946.003-6.556 5.338-11.891 11.893-11.891 3.181.001 6.167 1.24 8.413 3.488 2.245 2.248 3.481 5.236 3.48 8.414-.003 6.557-5.338 11.892-11.893 11.892-1.99-.001-3.951-.5-5.688-1.448l-6.305 1.654zm6.597-3.807c1.676.995 3.276 1.591 5.392 1.592 5.448 0 9.886-4.434 9.889-9.885.002-5.462-4.415-9.89-9.881-9.892-5.452 0-9.887 4.434-9.889 9.884-.001 2.225.651 3.891 1.746 5.634l-.999 3.648 3.742-.981zm11.387-5.464c-.074-.124-.272-.198-.57-.347-.297-.149-1.758-.868-2.031-.967-.272-.099-.47-.149-.669.149-.198.297-.768.967-.941 1.165-.173.198-.347.223-.644.074-.297-.149-1.255-.462-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.297-.347.446-.521.151-.172.2-.296.3-.495.099-.198.05-.372-.025-.521-.075-.148-.669-1.611-.916-2.206-.242-.579-.487-.501-.669-.51l-.57-.01c-.198 0-.52.074-.792.372s-1.04 1.016-1.04 2.479 1.065 2.876 1.213 3.074c.149.198 2.095 3.2 5.076 4.487.709.306 1.263.489 1.694.626.712.226 1.36.194 1.872.118.571-.085 1.758-.719 2.006-1.413.248-.695.248-1.29.173-1.414z" />
                            </svg>
                            ØªÙˆØ§ØµÙ„ Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨
                        </button>
                    </div>
                </div>
            </section>

        </main>

        <!-- Sidebar -->
        <aside class="space-y-6">
            <div class="bg-white rounded-xl p-6 shadow-sm border border-gray-100 sticky top-4">
                <h4 class="font-bold text-gray-900 mb-4">ØªØ®ØµØµØ§Øª Ø£Ø®Ø±Ù‰ ÙÙŠ {{ hospital.name_ar }}</h4>
                <ul class="space-y-3">
                    {% if hospital.success_rates.centers_of_excellence %}
                    {% for center in hospital.success_rates.centers_of_excellence[:5] %}
                    <li>
                        <a href="/hospitals/{{ hospital.slug }}/specialties/{{ center.name_en|lower|replace(' ', '-') }}"
                            class="flex items-center gap-3 text-gray-600 hover:text-teal-600 transition p-2 rounded-lg hover:bg-gray-50">
                            <span class="text-xl">
                                {% if center.icon == 'heart' %}â¤ï¸
                                {% elif center.icon == 'ribbon' %}ğŸ—ï¸
                                {% else %}ğŸ¥{% endif %}
                            </span>
                            <span class="text-sm font-semibold">{{ center.name_ar }}</span>
                        </a>
                    </li>
                    {% endfor %}
                    <li class="pt-2 border-t border-gray-100">
                        <a href="/hospitals/{{ hospital.slug }}/specialties"
                            class="text-teal-600 font-bold text-sm block text-center">Ø¹Ø±Ø¶ ÙƒÙ„ Ø§Ù„ØªØ®ØµØµØ§Øª</a>
                    </li>
                    {% endif %}
                </ul>
            </div>
        </aside>

    </div>
</div>

<script>
    function openWhatsApp() {
        const hospitalName = "{{ hospital.name_ar }}";
        const specialty = "{{ local_specialty.name_ar if local_specialty else global_specialty.name_ar }}";
        const message = encodeURIComponent(`Ù…Ø±Ø­Ø¨Ø§Ù‹ØŒ Ø£Ø±ØºØ¨ ÙÙŠ Ø§Ù„Ø§Ø³ØªÙØ³Ø§Ø± Ø¹Ù† Ø¹Ù„Ø§Ø¬ ${specialty} ÙÙŠ ${hospitalName}`);
        {% if hospital.success_rates and hospital.success_rates.contact and hospital.success_rates.contact.whatsapp %}
        const whatsappNumber = "{{ hospital.success_rates.contact.whatsapp }}";
        {% else %}
        const whatsappNumber = "966500000000";
        {% endif %}
        window.open(`https://wa.me/${whatsappNumber}?text=${message}`, '_blank');
    }
</script>
{% endblock %}